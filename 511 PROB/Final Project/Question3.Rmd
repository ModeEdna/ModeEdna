---
title: "Question 3 Final Project"
author: "Eduardo Armenta"
date: "2022-12-02"
output:
  html_document:
    toc: true
    toc_float: true
    code_folding: hide
    theme: lumen
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r spotify, message=FALSE}
library(dplyr)
# grab the Mexico and US Top 50 playlists
mex <- read.csv('./mex50.csv')
us <- read.csv('./GitHub/filtered_usa_top50.csv')
# add an identifier column to the us playlist
us$Playlist <- 'US50'
# put both data frames into one
both <- bind_rows(mex, us)
```


# **Question 3**
Are Valence and Danceability scores dependent on the playlist they come from (Top 50 Mexico vs Top 50 USA)?

## EDA

To get an initial understanding of the data, we will have to do some exploration. We believe that the mean of our selected variables will be different based on the country's playlist they belong to, but some visualizations would help in seeing the relationships more clearly. Mexico is often seen as a happy country, while the US struggles a bit more in this department; we would expect these feeling to be reflected on the music they listen to. For this, we will be comparing the Valence score of the top 50 songs from each country. For reference, a Valence Score measures (from 0 to 1) the musical positiveness conveyed by a track. Tracks with high valence sound more positive (e.g. happy, cheerful, euphoric), while tracks with low valence sound more negative (e.g. sad, depressed, angry).

The other variable we'd like to compare would be the Danceability score. More often than not, people dance when they're happy. We would expected for Mexico's Danceability score to be higher than the US score. For reference, a Danceability score describes how suitable a track is for dancing based on a combination of musical elements including tempo, rhythm stability, beat strength, and overall regularity. A value of 0.0 is least danceable and 1.0 is most danceable.


```{r jitter1, warning=FALSE, message=FALSE}
library(ggplot2)
library(ggdark)
ggplot(both, aes(x=Playlist, y=valence, color=Playlist)) +
  geom_jitter(position=position_jitter(0.05), cex=2, shape=16) + 
  stat_summary(fun.y=mean, geom='point', shape=18, size=3, color='black') +
  ggtitle('Comparing Valence for the Mexico and USA Top 50 Songs') +
  theme(plot.title = element_text(hjust = 0.5, size=16), plot.caption = element_text(hjust = 0.5)) +
  ylab('Valence') +
  xlab('Playlist') +
  theme(legend.position='none') +
  scale_color_manual(values=c("#78866b", "#cd5c5c")) +
  labs(caption = 'Figure 3.1: Distribution of Valence for Mexico and USA Top 50')
  #dark_mode()
```

```{r jitter2, warning=FALSE}
library(ggplot2)
ggplot(both, aes(x=Playlist, y=danceability, color=Playlist)) +
  geom_jitter(position=position_jitter(0.05), cex=2, shape=16) + 
  stat_summary(fun.y=mean, geom='point', shape=18, size=3, color='black') +
  ggtitle('Comparing Danceability for the Mexico and USA Top 50 Songs') +
  theme(plot.title = element_text(hjust = 0.5, size=16), plot.caption = element_text(hjust = 0.5)) +
  ylab('Danceability') +
  xlab('Playlist') +
  theme(legend.position='none') +
  scale_color_manual(values=c("#78866b", "#cd5c5c")) +
  labs(caption = 'Figure 3.2: Distribution of Danceability for Mexico and USA Top 50')
```

### Quick observations:

Before trying a hypothesis test, we can make some quick observations using the visualizations. Within both, the black triangle represents the mean for the variable within their respective playlist. In both variables, the mean for Mexico is significantly higher than the mean for the US. Although Mexico's Danceability scores are noticeably more concentrated at the top of the graph, the scores for Valence have a more even distribution. Albeit, both variable means for Mexico are greatly higher than the ones for the US. If we had to make a conclusion using only EDA, I would conclude that the label does in fact afect the variable scores. But, we know better than to make conclusions based on EDA. That's why we'll do an MANOVA test.

## Hypothesis testing

Given that we have a limited amount of data points (50 each), I'll have to get a bootstrap of the sample means.

```{r}
# separate the two variables for each label
mex.v <- mex$valence
us.v <- us$valence
mex.d <- mex$danceability
us.d <-us$danceability

# bootstrap the means
r.manova <- manova(cbind(danceability, valence) ~ Playlist, data=both)
summary(r.manova)

# more info
summary.aov(r.manova)
```

## Conclusion

The MANOVA test is used to find if more than one variable are dependent on another variable. In this case, we wanted to test if Valence and Danceability scores are dependent on their class labels (i.e. whether they come from the Mexico Top 50 or US Top 50 playlist). We can take the previous sentence as our null hypothesis; if we were to reject it, that would mean that there is a relationship between playlist label and the variables of interest.

After conducting the hypothesis test, the output gave us p-values smaller than 0.05, meaning that we can reject the null hypothesis. With these results, our initial thoughts are confirmed, meaning that the music coming from Mexico's and the US' top 50 playlists have differing variable scores. For Mexico, the mood and danceability of the song are high, while the US has lower average scores for both variables.

## Appendix

Bootstrap for the variables:

```{r, results=FALSE}
# separate the two variables for each label
mex.v <- mex$valence
us.v <- us$valence
mex.d <- mex$danceability
us.d <-us$danceability

# bootstrap the means
n <- 10000
n2 <- 50
mex.v.boot <- replicate(n, mean(sample(mex.v, n2, replace=TRUE)))
us.v.boot <- replicate(n, mean(sample(us.v, n2, replace=TRUE)))
mex.d.boot <- replicate(n, mean(sample(mex.d, n2, replace=TRUE)))
us.d.boot <- replicate(n, mean(sample(us.d, n2, replace=TRUE)))

# create a valence dataframe with the boots as columns
df <- data.frame(matrix(ncol = 2, nrow = n*2))
names <- c("Mean", "Boot")
colnames(df) <- names
mexValName <- rep('MexValence', n)
usValName <- rep('USValence', n)
all <- c(mexValName, usValName)
df$Boot <- all
df$Mean <- c(mex.v.boot, us.v.boot)

# create a dance dataframe with the boots as columns
df2 <- data.frame(matrix(ncol = 2, nrow = n*2))
names <- c("Mean", "Boot")
colnames(df2) <- names
mexDanName <- rep('MexDance', n)
usDanName <- rep('USDance', n)
all <- c(mexDanName, usDanName)
df2$Boot <- all
df2$Mean <- c(mex.d.boot, us.d.boot)
```

```{r}
head(df)
head(df2)
```

```{r, message=FALSE, warning=FALSE}
# histogram of the boots for valence
ggplot(df, aes(x=Mean, fill=Boot)) +
  geom_histogram() +
  theme(plot.title = element_text(hjust = 0.5, size=16), axis.text=element_text(size=10), axis.title=element_text(size=14), plot.caption = element_text(hjust = 0.5)) +
  ggtitle('Distribution of sample means for Valence') +
  ylab('Count') +
  xlab('Sample mean') +
  scale_fill_manual(name='Playlist', values=c("#78866b", "#cd5c5c")) +
  labs(caption = 'Figure 3.3: Histogram of Sample Means for Valence')
```

```{r, warning=FALSE, message=FALSE}
# histogram of the boots for danceability
ggplot(df2, aes(x=Mean, fill=Boot)) +
  geom_histogram() +
  theme(plot.title = element_text(hjust = 0.5, size=16), axis.text=element_text(size=10), axis.title=element_text(size=14), plot.caption = element_text(hjust = 0.5)) +
  ggtitle('Distribution of sample means for Danceability') +
  ylab('Count') +
  xlab('Sample mean') +
  scale_fill_manual(name = "Playlist", values=c("#78866b", "#cd5c5c")) +
  labs(caption = 'Figure 3.4: Histogram of Sample Means for Danceability')
```



# separate the two variables for each label
mex.v <- mex$valence
us.v <- us$valence
mex.d <- mex$danceability
us.d <-us$danceability
