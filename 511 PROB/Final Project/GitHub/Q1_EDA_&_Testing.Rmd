---
title: "Q1_EDA_&_Testing"
author: "Brian Wimmer"
date: "2022-11-30"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
# Load libraries
library(ggplot2)
library(tidyverse)
library(psych) 
library(dplyr)
library(arsenal)
```

```{r}
# Load data

# Top 50 USA
usa <- read.csv('/Users/brianwimmer/Desktop/Georgetown/ANLY 511/Final Project/filtered_usa_top50.csv')

# Top 50 UK
uk <- read.csv('/Users/brianwimmer/Desktop/Georgetown/ANLY 511/Final Project/filtered_uk_top50.csv')
```

```{r}
# adding "country" column to each df; will be used for EDA purposes
usa$country <- "USA"
uk$country <- "UK"
```

```{r}
# combine usa and uk into one df
both <- rbind(usa, uk)
```

```{r}
# create df of both with just three variables (danceability, energy, and valence) of interest and country
both.interest <- both %>% select(danceability, energy, valence, country)
```

```{r}
# summary statistics - USA
summary(usa[c('danceability', 'energy', 'valence')])
```

```{r}
# summary statistics - UK
summary(uk[c('danceability', 'energy', 'valence')])
```

Comparison of Danceability - very minimal difference in the mean of danceability. UK is 0.64 and USA is 0.63. Expected UK to be higher as their charts often reflect more dance/edm/pop songs ("club music"). Danceability represents a combination of tempo, rhythm stability, beat strength, and regularity.

Comparison of Energy - somewhat significant difference in the mean of energy. UK is higher at 0.62 and USA is lower at 0.54. Energy represents the intensity and activity of a song, thought this would compare easily to danceability but they are different.

Comparison of Valence - somewhat significant difference in the mean of valence. UK is higher at 0.5 and USA is lower at 0.4. Valence compares the musical positiveness of a song, higher value means more positive.


```{r}
# Boxplot for danceability varible
both %>%
  ggplot( aes(x = country, y = danceability, fill=country)) +
  geom_boxplot() + ggtitle("Danceability of Top 50 Songs by Country")+
    scale_fill_brewer(palette="Set1") +
  xlab("Country") + ylab("Danceability")
```

```{r}
# Boxplot for energy varible
both %>%
  ggplot( aes(x = country, y = energy, fill=country)) +
  geom_boxplot() + ggtitle("Energy of Top 50 Songs by Country")+
    scale_fill_brewer(palette="Set1") +
  xlab("Country") + ylab("Energy")
```

```{r}
# Boxplot for valence varible
both %>%
  ggplot( aes(x = country, y = valence, fill=country)) +
  geom_boxplot() + ggtitle("Valence of Top 50 Songs by Country")+
    scale_fill_brewer(palette="Set1") +
  xlab("Country") + ylab("Valence")
```

```{r}
set.seed(1999)

# Hypothesis Testing - T-test for danceability
uk.dance <- subset(both.interest, select=danceability, subset=country=="UK", drop=T)
usa.dance <- subset(both.interest, select=danceability,subset=country=="USA", drop=T)

t.test(uk.dance, usa.dance, alt="greater")
```
Let $\mu_S$ = population mean dancebility of USA and $\mu_K$ = population mean dancebility of UK
Null - $H_0: \mu_K - \mu_S = 0$ There is no difference in the average danceability between UK and USA.
Alternative - $H_a: \mu_K - \mu_S > 0$ The average danceability is larger for UK than USA.

Interpretation - Since p-value is greater than 0.05, at 5% significance level, we have enough evidence to conclude that we fail to reject the null hypothesis. Therefore there is not strong evidence that the danceability of music in the top 50 in the UK is higher than music in the top 50 in the USA.




```{r}
set.seed(1999)

# Hypothesis Testing - T-test for energy
uk.energy <- subset(both.interest, select=energy, subset=country=="UK", drop=T)
usa.energy <- subset(both.interest, select=energy,subset=country=="USA", drop=T)

t.test(uk.energy, usa.energy, alt="greater")
```
Let $\mu_S$ = population mean energy of USA and $\mu_K$ = population mean energy of UK
Null - $H_0: \mu_K - \mu_S = 0$ There is no difference in the average energy between UK and USA.
Alternative - $H_a: \mu_K - \mu_S > 0$ The average energy is larger for UK than USA.

Interpretation - Since p-value is less than 0.05, at 5% significance level, we have enough evidence to conclude that we reject the null hypothesis. Therefore there is strong evidence that the energy of music in the top 50 in the UK is higher than music in the top 50 in the USA.

```{r}
set.seed(1999)

# bootstrap ratio of means of energy
N <- 10000
energy.diff.mean.ratio <- numeric(N) 

for (i in 1:N)
{
uk.sample <- sample(uk.energy, 50, replace = TRUE)
usa.sample <- sample(usa.energy, 50, replace = TRUE) 
energy.diff.mean.ratio[i] <- mean(uk.sample) / mean(usa.sample)
}

hist(energy.diff.mean.ratio,main = "Bootstrap Distribution of Difference in Mean of Energy", col = 'green', xlab = 'Difference in Mean of Energy')
abline(v = mean(uk.energy) / mean(usa.energy), col = "blue", lty = 2)


# 95 percent confidence interval
quantile(energy.diff.mean.ratio, c(0.025, 0.975))
```
The 95% bootstrap percentile confidence interval for the ratio of means (UK energy / USA energy) is (1.03, 1.32). Thus, we are 95% confident that the energy of top 50 UK songs are, on average, between 1.03 and 1.32 times greater than top 50 USA songs.



```{r}
set.seed(1999)

# Hypothesis Testing - T-test for valence
uk.valence <- subset(both.interest, select=valence, subset=country=="UK", drop=T)
usa.valence <- subset(both.interest, select=valence,subset=country=="USA", drop=T)

t.test(uk.valence, usa.valence, alt="greater")
```
Let $\mu_S$ = population mean valence of USA and $\mu_K$ = population mean valence of UK
Null - $H_0: \mu_K - \mu_S = 0$ There is no difference in the average valence between UK and USA.
Alternative - $H_a: \mu_K - \mu_S > 0$ The average valence is larger for UK than USA.

Interpretation - Since p-value is less than 0.05, at 5% significance level, we have enough evidence to conclude that we reject the null hypothesis. Therefore there is strong evidence that the valence of music in the top 50 in the UK is higher than music in the top 50 in the USA.

```{r}
set.seed(1999)

# bootstrap ratio of means of valence
N <- 10000
valence.diff.mean.ratio <- numeric(N) 

for (i in 1:N)
{
uk.sample <- sample(uk.valence, 50, replace = TRUE)
usa.sample <- sample(usa.valence, 50, replace = TRUE) 
valence.diff.mean.ratio[i] <- mean(uk.sample) / mean(usa.sample)
}

hist(valence.diff.mean.ratio,main = "Bootstrap Distribution of Difference in Mean of Valence", col = 'green', xlab = 'Difference in Mean of Valence')
abline(v = mean(uk.valence) / mean(usa.valence), col = "blue", lty = 2)


# 95 percent confidence interval
quantile(valence.diff.mean.ratio, c(0.025, 0.975))
```
The 95% bootstrap percentile confidence interval for the ratio of means (UK valence / USA valence) is (1, 1.59). Thus, we are 95% confident that the valence of top 50 UK songs are, on average, between 1 and 1.59 times greater than top 50 USA songs.






